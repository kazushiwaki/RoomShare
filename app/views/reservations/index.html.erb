<!-- 削除確認モーダル -->
<div id="delete-modal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-gray-800 bg-opacity-50">
  <div class="bg-white rounded-lg shadow-lg max-w-sm w-full p-6 flex flex-col items-center">
    <h2 class="text-lg font-bold text-gray-800 mb-4 text-center">削除確認</h2>
    <p class="text-gray-600 mb-6 text-center">この予約を削除してもよろしいですか？</p>
    <div class="flex justify-center space-x-3">
      <button id="cancel-button" class="px-4 py-2 bg-gray-300 text-gray-700 rounded-lg hover:bg-gray-400">キャンセル</button>
      <a id="confirm-delete-link" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 cursor-pointer">削除</a>
    </div>
  </div>
</div>

<div class="py-8">
  <!-- 戻るボタン -->
  <div class="mb-5">
    <%= link_to rooms_path, class: "btn btn-ghost text-primary" do %>
      <i class="fas fa-arrow-left mr-1"></i>戻る
    <% end %>
  </div>

  <h1 class="text-4xl font-bold text-center mb-8">予約一覧</h1>

  <% if @reservations.any? %>
    <div class="overflow-x-auto mt-6">
      <table class="table w-full border border-gray-200">
        <thead>
          <tr class="bg-gray-100">
            <th class="px-4 py-2 text-left">施設画像</th>
            <th class="px-4 py-2 text-left">施設名</th>
            <th class="px-4 py-2 text-left">紹介文</th>
            <th class="px-4 py-2 text-left">合計料金</th>
            <th class="px-4 py-2 text-left">チェックイン日</th>
            <th class="px-4 py-2 text-left">チェックアウト日</th>
            <th class="px-4 py-2 text-left">予約確定日時</th>
            <th class="px-4 py-2"></th>
            <th class="px-4 py-2"></th>
          </tr>
        </thead>
        <tbody>
          <% @reservations.each do |reservation| %>
            <% nights = (reservation.check_out_date - reservation.check_in_date).to_i %>
            <% total_price = reservation.room.price_per_night * nights %>
            <tr class="hover:bg-gray-50">
              <!-- 施設画像 -->
              <td class="px-4 py-2 border-t">
                <% if reservation.room.image.attached? %>
                  <%= image_tag reservation.room.image.variant(resize_to_fill: [100, 80]).processed,
                      class: "w-[100px] h-[80px] object-cover rounded-md" %>
                <% else %>
                  <%= image_tag "default-image-room.png",
                      class: "w-[100px] h-[80px] object-cover rounded-md" %>
                <% end %>
              </td>
              <!-- 施設名 -->
              <td class="px-4 py-2 border-t font-bold">
                <%= link_to reservation.room.name, room_path(reservation.room) %></h2>
              </td>
              <!-- 紹介文 -->
              <td class="px-4 py-2 border-t text-sm text-gray-600">
                <%= reservation.room.description.truncate(50) %>
              </td>
              <!-- 合計料金 -->
              <td class="px-4 py-2 border-t">
                ￥<%= number_with_delimiter(total_price, delimiter: ',') %>
              </td>
              <!-- チェックイン日 -->
              <td class="px-4 py-2 border-t">
                <%= reservation.check_in_date.to_s(:datetime_jp) %>
              </td>
              <!-- チェックアウト日 -->
              <td class="px-4 py-2 border-t">
                <%= reservation.check_out_date.to_s(:datetime_jp) %>
              </td>
              <!-- 予約確定日時 -->
              <td class="px-4 py-2 border-t">
                <%= reservation.created_at.to_s(:datetime_time_and_minutes_jp) %>
              </td>
              <!-- 編集ボタン -->
              <td class="px-2 py-2 border-t">
                <%= link_to "編集", edit_reservation_path(reservation),
                    class: "btn btn-md btn-secondary hover:bg-accent-focus" %>
              </td>
              <!-- 削除ボタン -->
              <td class="px-2 py-2 border-t">
                <%= link_to "削除".html_safe, "javascript:void(0);",
                method: :delete,
                class: "delete-link btn btn-error btn-md hover:bg-error-focus",
                data: { url: reservation_path(reservation) } %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
  <% else %>
    <div class="text-center text-gray-500 mt-10 p-10 bg-white rounded-lg shadow-md">
      <i class="far fa-calendar-times text-4xl mb-4"></i>
      <p>予約はまだありません。</p>
    </div>
  <% end %>
</div>
